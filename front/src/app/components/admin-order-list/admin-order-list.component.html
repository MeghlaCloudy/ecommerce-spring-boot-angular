<div class="container mt-5">
  <h2 class="mb-4">All Orders (Admin Panel)</h2>

  <!-- ... লোডিং, এরর, নো অর্ডার মেসেজ আগের মতোই -->

  <div *ngIf="orders.length > 0">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Order ID</th>
          <th>User</th>
          <th>Total Amount</th>
          <th>Status</th>
          <th>Payment Method</th>
          <th>Order Date</th>
          <th>Shipping Address</th>
          <th>Items Count</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders" (click)="openOrderDetails(order)" class="cursor-pointer">
          <td><strong>#{{ order.orderId }}</strong></td>
          <td>{{ order.userName || 'N/A' }}</td>
          <td><strong>{{ order.totalAmount }} ৳</strong></td>
          <td (click)="$event.stopPropagation()">
            <select class="form-select form-select-sm" [(ngModel)]="order.status"
                    (ngModelChange)="updateStatus(order.orderId, order.status)">
              <option value="PENDING">Pending</option>
              <option value="PAID">Paid</option>
              <option value="SHIPPED">Shipped</option>
              <option value="DELIVERED">Delivered</option>
              <option value="CANCELLED">Cancelled</option>
            </select>
          </td>
          <td>{{ order.paymentMethod || 'N/A' }}</td>
          <td>{{ order.createdAt | date:'medium' }}</td>
          <td>{{ order.shippingAddressInfo || 'No address' }}</td>
          <td><span class="badge bg-primary">{{ order.items.length || 0 }} items</span></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Order Details Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Order Details - #{{ selectedOrder?.orderId }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" #orderDetailsContent>
        <div *ngIf="selectedOrder">
          <p><strong>User:</strong> {{ selectedOrder.userName }}</p>
          <p><strong>Order Date:</strong> {{ selectedOrder.createdAt | date:'full' }}</p>
          <p><strong>Payment Method:</strong> {{ selectedOrder.paymentMethod }}</p>
          <p><strong>Status:</strong> 
            <span class="badge bg-warning" *ngIf="selectedOrder.status === 'PENDING'">Pending</span>
            <span class="badge bg-success" *ngIf="selectedOrder.status === 'DELIVERED'">Delivered</span>
            <span class="badge" [ngClass]="{
              'bg-info': selectedOrder.status === 'SHIPPED',
              'bg-secondary': selectedOrder.status === 'CANCELLED',
              'bg-primary': selectedOrder.status === 'PAID'
            }">{{ selectedOrder.status }}</span>
          </p>
          <p><strong>Shipping Address:</strong><br>
            {{ selectedOrder.shippingAddressInfo || 'No address provided' }}
          </p>

          <h5 class="mt-4">Ordered Products</h5>
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>Product</th>
                <th class="text-center">Price</th>
                <th class="text-center">Quantity</th>
                <th class="text-center">Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of selectedOrder.items">
                <td>{{ item.productName }}</td>
                <td class="text-center">{{ item.price }} ৳</td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-center">{{ item.total }} ৳</td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="table-dark">
                <th colspan="3" class="text-end">Grand Total:</th>
                <th class="text-center">{{ selectedOrder.totalAmount }} ৳</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button class="btn btn-primary" (click)="printOrder()">
          <i class="bi bi-printer"></i> Print Order
        </button>
      </div>
    </div>
  </div>
</div>