<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
      <!-- Loading State -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading product details...</p>
      </div>

      <!-- Product Detail -->
      <div *ngIf="!loading && product" class="card">
        <!-- Header -->
        <div class="card-header bg-light">
          <div class="d-flex justify-content-between align-items-center">
            <h1 class="h4 mb-0">{{ product.name }}</h1>
            <div>
              <span class="badge bg-primary me-2">{{ product.sku }}</span>
              <span 
                class="badge" 
                [ngClass]="{
                  'bg-success': product.active,
                  'bg-secondary': !product.active
                }"
              >
                {{ product.active ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="row">
            <!-- Images Section -->
            <div class="col-lg-6">
              <!-- Main Image -->
              <div class="main-image mb-3">
                <img 
                  [src]="'http://localhost:8080'+product.images[activeImageIndex] || 'https://via.placeholder.com/500'" 
                  [alt]="product.name"
                  class="img-fluid rounded border"
                  style="max-height: 400px; width: 100%; object-fit: contain;"
                >
              </div>

              <!-- Thumbnails -->
              <div *ngIf="product.images && product.images.length > 1" class="thumbnails">
                <div class="row g-2">
                  <div 
                    *ngFor="let image of product.images; let i = index"
                    class="col-3"
                  >
                    <div 
                      class="thumbnail-item border rounded p-1"
                      [class.border-primary]="i === activeImageIndex"
                      (click)="setActiveImage(i)"
                      style="cursor: pointer;"
                    >
                      <img 
                        [src]="'http://localhost:8080'+image" 
                        [alt]="'Thumbnail ' + (i + 1)"
                        class="img-fluid"
                        style="height: 80px; object-fit: cover; width: 100%;"
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Details Section -->
            <div class="col-lg-6">
              <!-- Price Section -->
              <div class="mb-4">
                <h2 class="text-primary mb-2">
                  {{ formatPrice(getDiscountedPrice()) }}
                </h2>
                <div *ngIf="product.discountPrice" class="d-flex align-items-center gap-2 mb-3">
                  <span class="text-muted text-decoration-line-through">
                    {{ formatPrice(product.price) }}
                  </span>
                  <span class="badge bg-success">
                    Save {{ getDiscountPercent() }}%
                  </span>
                </div>
              </div>

              <!-- Stock & Brand -->
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="card border-0 bg-light">
                    <div class="card-body text-center">
                      <h6 class="text-muted mb-1">Stock Status</h6>
                      <span 
                        class="badge fs-6" 
                        [ngClass]="'bg-' + getStockClass()"
                      >
                        {{ getStockStatus() }}
                      </span>
                      <div class="mt-2">
                        <small class="text-muted">{{ product.stockQuantity }} units available</small>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-0 bg-light">
                    <div class="card-body text-center">
                      <h6 class="text-muted mb-1">Brand</h6>
                      <h5 class="mb-0">{{ product.brandName }}</h5>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Categories -->
              <div class="mb-4">
                <h6 class="text-muted mb-2">Categories</h6>
                <div *ngIf="product.categories && product.categories.length > 0">
                  <span *ngFor="let category of product.categories" class="badge bg-info me-1 mb-1">
                    {{ category }}
                  </span>
                </div>
                <div *ngIf="!product.categories || product.categories.length === 0" class="text-muted">
                  No categories assigned
                </div>
              </div>

              <!-- Description -->
              <div class="mb-4">
                <h6 class="text-muted mb-2">Description</h6>
                <p class="mb-0" style="white-space: pre-line;">
                  {{ product.description || 'No description available.' }}
                </p>
              </div>

              <!-- Additional Info -->
              <div class="card border">
                <div class="card-body">
                  <h6 class="text-muted mb-3">Additional Information</h6>
                  <div class="row">
                    <!-- <div class="col-6">
                      <small class="text-muted">Created</small>
                      <div class="fw-semibold">
                        {{ product.createdAt | date:'medium' }}
                      </div>
                    </div> -->
                    <!-- <div class="col-6">
                      <small class="text-muted">Last Updated</small>
                      <div class="fw-semibold">
                        {{ product.updatedAt! | date:'medium' }}
                      </div>
                    </div> -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="card-footer bg-light">
          <div class="d-flex justify-content-between">
            <button class="btn btn-outline-secondary" routerLink="/products">
              <i class="bi bi-arrow-left me-1"></i> Back to Products
            </button>
            <div>
              <button *ngIf="authService.hasRole('ROLE_ADMIN')" class="btn btn-warning me-2" [routerLink]="['/products/edit', product.id]">
                <i class="bi bi-pencil me-1"></i> Edit Product
              </button>


              <button *ngIf="authService.hasRole('ROLE_ADMIN')" class="btn btn-danger" (click)="deleteProduct(product.id)">
                <i class="bi bi-trash me-1"></i> Delete
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Not Found -->
      <div *ngIf="!loading && !product" class="text-center py-5">
        <i class="bi bi-exclamation-circle display-1 text-muted"></i>
        <h3 class="mt-3">Product Not Found</h3>
        <p class="text-muted">The product you're looking for doesn't exist.</p>
        <button class="btn btn-primary" routerLink="/products">
          Back to Products
        </button>
      </div>
    </div>
  </div>
</div>